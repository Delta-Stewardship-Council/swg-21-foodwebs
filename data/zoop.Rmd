---
title: "zoop heatmap"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load packages
```{r, message=FALSE}
require(dplyr)
require(zooper)
require(lubridate)
require(readr)
require(tidyr)
require(ggplot2)
```

Load core stations
```{r, message=FALSE}
zoop_stations<-read_csv("zoop_station_lookup.csv")%>%
  filter(Core%in%c(1, 2))
```

Load zoop data
```{r}
zoop_data<-Zoopsynther(Data_type="Community", Sources="EMP", Time_consistency = TRUE)%>%
  filter(Station%in%zoop_stations$StationNZ)%>%
  mutate(Month=month(Date))
```

Summarize zoop effort by date and station
```{r}
zoop_data_station<-zoop_data%>%
  select(Month, Year, Station)%>%
  distinct()%>%
  mutate(type="present")%>%
  complete(Month, Year, Station, fill=list(type="missing"))%>%
  mutate(Date=dmy(paste("1", Month, Year)))
```

Plot zoop effort by date and station
```{r}
ggplot(zoop_data_station, aes(x=Date, y=Station, color=type))+
  geom_point()+
  scale_color_manual(values=c("firebrick3", "black"))+
  theme_bw()
```


Summarize zoop effort by month and year
```{r}
zoop_data_sum<-zoop_data%>%
  group_by(Month, Year)%>%
  summarise(N=n(), .groups="drop")
```

Plot heat map
```{r}
ggplot(zoop_data_sum, aes(y=Month, x=Year, fill=N))+
  geom_tile()+
  scale_fill_viridis_c()+
  scale_y_continuous(breaks=1:12)+
  coord_cartesian(expand=FALSE)+
  theme_bw()
```

